{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center">
    <h2>Tarefas</h2>
    <a class="btn btn-primary" href="{% url 'tarefas:task-create' %}">Nova Tarefa</a>
  </div>
  <hr>
  <form method="get" class="mb-3">
    <label>Filtrar por projeto:</label>
    <select name="project" onchange="this.form.submit()" class="form-select w-auto d-inline-block ms-2">
      <option value="">— Todos —</option>
      {% for p in projects %}
        <option value="{{ p.pk }}" {% if request.GET.project == p.pk|stringformat:"s" %}selected{% endif %}>{{ p.nome }}</option>
      {% endfor %}
    </select>
  </form>

  {% for t in tasks %}
    <div class="card mb-2">
      <div class="card-body">
        <h5><a href="{% url 'tarefas:task-detail' t.pk %}">{{ t.titulo }}</a></h5>
        <p>Projeto: <a href="{% url 'projetos:project-detail' t.projeto.pk %}">{{ t.projeto.nome }}</a></p>
        <p>Status: {{ t.get_status_display }} — Prazo: {{ t.prazo|default:"—" }}</p>
      </div>
    </div>
  {% empty %}
    <p>Sem tarefas.</p>
  {% endfor %}
</div>
{% endblock %}
